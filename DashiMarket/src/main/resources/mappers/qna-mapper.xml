<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="edu.og.project.goods.model.dao.QnaMapper">
	
	
	
	<!-- 댓글 삽입-->
	<insert id="qnaInsert" useGeneratedKeys="true">
		
		<selectKey order="BEFORE" resultType="_int" keyProperty="commentNo">
			
			SELECT SEQ_COMMENT_NO.NEXTVAL FROM DUAL	
		</selectKey>
		
		INSERT INTO "COMMENT" VALUES(
		${commentNo}
		,#{postNo},
		<choose>
			<when test="parentCommentNo == 0">
				 null		
			</when>
			<otherwise>
				${parentCommentNo}
				
			</otherwise>
		</choose>
		
		, 1 <!--회원 번호-->
		, #{commentContent},
		 SYSDATE, null, DEFAULT
		 , #{isSecret})
		
		
	</insert>
	
	
	<!-- 부모 댓글 비밀글 여부 조회-->
	
	<select id="selectIsSecret" resultType="string">
		SELECT SECRET_YN
		FROM "COMMENT"
		WHERE COMMENT_NO = ${parentCommentNo}
	</select>
	
	<!-- 부모 댓글 상태 변경-->
	<update id="statusUpdate">
		UPDATE "COMMENT" SET
		COMMENT_STATUS = 'PUBLISHED'
		WHERE COMMENT_NO = ${parentCommentNo}
	</update>
</mapper>